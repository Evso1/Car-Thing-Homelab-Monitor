<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=800, height=480">
    <title>Homelab Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #ff8800;
            width: 800px;
            height: 480px;
            overflow: hidden;
            position: relative;
            font-size: 16px;
        }

        .page {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
            padding: 15px;
        }

        .page.active {
            display: block;
        }

        .header {
            text-align: center;
            border-bottom: 2px solid #ff8800;
            padding-bottom: 8px;
            margin-bottom: 12px;
        }

        .header h1 {
            font-size: 36px;
            text-shadow: 0 0 10px #ff8800;
        }

        .header .time {
            font-size: 14px;
            opacity: 0.7;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .stat-box {
            background: #1a0a00;
            border: 2px solid #ff8800;
            padding: 10px;
            border-radius: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.7;
        }

        .stat-value {
            font-size: 40px;
            font-weight: bold;
            margin: 5px 0;
        }

        .stat-detail {
            font-size: 10px;
            opacity: 0.6;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #1a0a00;
            border: 1px solid #ff8800;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: #ff8800;
            transition: width 0.3s;
        }

        .process-list {
            background: #1a0a00;
            border: 2px solid #ff8800;
            padding: 10px;
            border-radius: 5px;
            height: 180px;
            overflow-y: auto;
        }

        .process-list h3 {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .process-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #331100;
            font-size: 14px;
        }

        .log-container {
            background: #1a0a00;
            border: 2px solid;
            padding: 10px;
            border-radius: 5px;
            height: 380px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.4;
        }

        .log-container.thinkcentre { border-color: #ffaa00; color: #ffaa00; }
        .log-container.pi { border-color: #ff4400; color: #ff4400; }
        .log-container.switch { border-color: #ff8800; color: #ff8800; }
        .log-container.alllogs { border-color: #ffdd00; color: #ffdd00; }

        /* ðŸ”¥ CRITICAL: Larger, tappable log lines for Page 5 */
        .log-container.alllogs .log-line {
            font-size: 20px !important;
            padding: 12px 0 !important;
            line-height: 1.6 !important;
            border-bottom: 2px solid #331100 !important;
        }

        .log-line {
            padding: 3px 0;
            border-bottom: 1px solid #331100;
            cursor: pointer;
        }

        .log-line:hover {
            background: #221100;
        }

        .nav-indicator {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            opacity: 0.6;
            display: flex;
            gap: 20px;
        }

        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #ff8800;
            background: transparent;
        }

        .nav-dot.active {
            background: #ff8800;
        }

        .warning { color: #ffaa00; }
        .critical { color: #ff0000; }
        .success { color: #00ff00; }

        .error-msg {
            text-align: center;
            margin-top: 100px;
            font-size: 16px;
            color: #ff0000;
        }
    </style>
</head>
<body>
    <!-- Page 1: Pi System Stats -->
    <div class="page active" id="page-system">
        <div class="header">
            <h1>[ PI SYSTEM MONITOR ]</h1>
            <div class="time" id="system-time">--:--:--</div>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">CPU</div>
                <div class="stat-value" id="cpu-value">--%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="cpu-bar"></div>
                </div>
            </div>

            <div class="stat-box">
                <div class="stat-label">TEMP</div>
                <div class="stat-value" id="temp-value">--Â°C</div>
            </div>

            <div class="stat-box">
                <div class="stat-label">MEMORY</div>
                <div class="stat-value" id="mem-value">--%</div>
                <div class="stat-detail" id="mem-detail">-- / -- GB</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="mem-bar"></div>
                </div>
            </div>

            <div class="stat-box">
                <div class="stat-label">DISK</div>
                <div class="stat-value" id="disk-value">--%</div>
                <div class="stat-detail" id="disk-detail">-- / -- GB</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="disk-bar"></div>
                </div>
            </div>
        </div>

        <div class="process-list">
            <h3>TOP PROCESSES</h3>
            <div id="process-list"></div>
        </div>
    </div>

    <!-- Page 2: ThinkCentre Logs -->
    <div class="page" id="page-thinkcentre">
        <div class="header" style="border-color: #ffaa00;">
            <h1 style="color: #ffaa00; text-shadow: 0 0 10px #ffaa00;">[ THINKCENTRE LOGS ]</h1>
            <div class="time" style="color: #ffaa00;" id="thinkcentre-time">--:--:--</div>
        </div>

        <div class="log-container thinkcentre" id="thinkcentre-logs">
            <div class="log-line">Connecting to Pi...</div>
        </div>
    </div>

    <!-- Page 3: Pi Logs -->
    <div class="page" id="page-pi">
        <div class="header" style="border-color: #ff4400;">
            <h1 style="color: #ff4400; text-shadow: 0 0 10px #ff4400;">[ PI LOGS ]</h1>
            <div class="time" style="color: #ff4400;" id="pi-time">--:--:--</div>
        </div>

        <div class="log-container pi" id="pi-logs">
            <div class="log-line">Connecting to Pi...</div>
        </div>
    </div>

    <!-- Page 4: Switch Logs -->
    <div class="page" id="page-switch">
        <div class="header" style="border-color: #ff8800;">
            <h1 style="color: #ff8800; text-shadow: 0 0 10px #ff8800;">[ SWITCH LOGS ]</h1>
            <div class="time" style="color: #ff8800;" id="switch-time">--:--:--</div>
        </div>

        <div class="log-container switch" id="switch-logs">
            <div class="log-line">Connecting to Pi...</div>
        </div>
    </div>

    <!-- Page 5: All Logs Menu -->
    <div class="page" id="page-alllogs">
        <div class="header" style="border-color: #ffdd00;">
            <h1 style="color: #ffdd00; text-shadow: 0 0 10px #ffdd00;">[ ALL LOGS ]</h1>
            <div class="time" style="color: #ffdd00;" id="alllogs-time">Tap a log to view</div>
        </div>

        <div class="log-container alllogs" id="alllogs-list">
            <div class="log-line">Loading...</div>
        </div>
    </div>

    <!-- Navigation Indicator -->
    <div class="nav-indicator">
        <div class="nav-dot active" data-page="0"></div>
        <div class="nav-dot" data-page="1"></div>
        <div class="nav-dot" data-page="2"></div>
        <div class="nav-dot" data-page="3"></div>
        <div class="nav-dot" data-page="4"></div>
    </div>

    <script>
        let currentPage = 0;
        const pages = ['system', 'thinkcentre', 'pi', 'switch', 'alllogs'];

        function showPage(index) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-dot').forEach(d => d.classList.remove('active'));

            document.getElementById(`page-${pages[index]}`).classList.add('active');
            document.querySelector(`.nav-dot[data-page="${index}"]`).classList.add('active');

            currentPage = index;

            if (index === 4) {
                loadAllLogs();
            }
        }

        // ðŸ”¥ RESTORED: Top button navigation (keys 1-5)
        document.addEventListener('keydown', (e) => {
            if (e.key === '1') showPage(0);
            else if (e.key === '2') showPage(1);
            else if (e.key === '3') showPage(2);
            else if (e.key === '4') showPage(3);
            else if (e.key === '5') showPage(4);
        });

        // Scroll wheel navigation
        document.addEventListener('wheel', (e) => {
            if (e.deltaY > 0) {
                // Counter-clockwise â†’ previous
                currentPage = (currentPage - 1 + pages.length) % pages.length;
            } else {
                // Clockwise â†’ next
                currentPage = (currentPage + 1) % pages.length;
            }
            showPage(currentPage);
        });

        // Touch navigation on "All Logs"
        document.getElementById('alllogs-list').addEventListener('click', (e) => {
            const target = e.target.closest('.log-line');
            if (target && target.dataset.path) {
                fetch(`/api/log?path=${encodeURIComponent(target.dataset.path)}`)
                    .then(res => res.json())
                    .then(data => {
                        const container = document.getElementById('alllogs-list');
                        container.innerHTML = data.logs.map(line =>
                            `<div class="log-line">${line.trim()}</div>`
                        ).join('');
                        container.scrollTop = 0;
                    })
                    .catch(err => {
                        console.error('Error loading log:', err);
                    });
            }
        });

        // API Fetchers (same as before)
        async function updateSystemStats() {
            try {
                const response = await fetch('/api/system');
                const data = await response.json();

                document.getElementById('system-time').textContent = new Date().toLocaleTimeString();
                document.getElementById('cpu-value').textContent = data.cpu.toFixed(1) + '%';
                document.getElementById('cpu-bar').style.width = data.cpu + '%';

                if (data.temperature) {
                    const tempEl = document.getElementById('temp-value');
                    tempEl.textContent = data.temperature.toFixed(1) + 'Â°C';
                    tempEl.className = 'stat-value' +
                        (data.temperature > 70 ? ' warning' : '') +
                        (data.temperature > 80 ? ' critical' : '');
                }

                document.getElementById('mem-value').textContent = data.memory.percent.toFixed(1) + '%';
                document.getElementById('mem-detail').textContent =
                    `${data.memory.used} / ${data.memory.total} GB`;
                document.getElementById('mem-bar').style.width = data.memory.percent + '%';

                document.getElementById('disk-value').textContent = data.disk.percent.toFixed(1) + '%';
                document.getElementById('disk-detail').textContent =
                    `${data.disk.used} / ${data.disk.total} GB`;
                document.getElementById('disk-bar').style.width = data.disk.percent + '%';

                const processList = document.getElementById('process-list');
                processList.innerHTML = data.processes.map(proc => `
                    <div class="process-row">
                        <span>${proc.name}</span>
                        <span>CPU: ${proc.cpu}% | MEM: ${proc.memory}%</span>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Error fetching system stats:', err);
            }
        }

        async function updateThinkCentreLogs() {
            try {
                document.getElementById('thinkcentre-time').textContent = new Date().toLocaleTimeString();
                const response = await fetch('/api/thinkcentre');
                const data = await response.json();
                const container = document.getElementById('thinkcentre-logs');
                container.innerHTML = data.logs.map(line =>
                    `<div class="log-line">${line.trim()}</div>`
                ).join('');
                container.scrollTop = container.scrollHeight;
            } catch (err) {
                console.error('Error fetching ThinkCentre logs:', err);
            }
        }

        async function updatePiLogs() {
            try {
                document.getElementById('pi-time').textContent = new Date().toLocaleTimeString();
                const response = await fetch('/api/pi');
                const data = await response.json();
                const container = document.getElementById('pi-logs');
                container.innerHTML = data.logs.map(line =>
                    `<div class="log-line">${line.trim()}</div>`
                ).join('');
                container.scrollTop = container.scrollHeight;
            } catch (err) {
                console.error('Error fetching Pi logs:', err);
            }
        }

        async function updateSwitchLogs() {
            try {
                document.getElementById('switch-time').textContent = new Date().toLocaleTimeString();
                const response = await fetch('/api/switch');
                const data = await response.json();
                const container = document.getElementById('switch-logs');
                container.innerHTML = data.logs.map(line =>
                    `<div class="log-line">${line.trim()}</div>`
                ).join('');
                container.scrollTop = container.scrollHeight;
            } catch (err) {
                console.error('Error fetching switch logs:', err);
            }
        }

        async function loadAllLogs() {
            try {
                const response = await fetch('/api/all-logs');
                const data = await response.json();
                const container = document.getElementById('alllogs-list');
                container.innerHTML = data.logs.map(log => `
                    <div class="log-line" data-path="${log.path}">
                        ${log.name} (${log.size})
                    </div>
                `).join('');
            } catch (err) {
                console.error('Error loading all logs:', err);
            }
        }

        setInterval(updateSystemStats, 2000);
        setInterval(updateThinkCentreLogs, 3000);
        setInterval(updatePiLogs, 3000);
        setInterval(updateSwitchLogs, 3000);

        updateSystemStats();
        updateThinkCentreLogs();
        updatePiLogs();
        updateSwitchLogs();
    </script>
</body>
</html>
